<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>About:Blank Launcher</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: monospace;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 50px;
    }
    input {
      width: 400px;
      padding: 8px;
      margin: 10px 0;
      font-size: 16px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: 1px solid #fff;
      background: transparent;
      color: #fff;
    }
    h1 {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>About:Blank Launcher</h1>
  <input id="url-input" type="text" placeholder="Enter full URL (https://...)">
  <button id="open-btn">Open in about:blank</button>
  <p id="status"></p>

  <script>
    const openBtn = document.getElementById("open-btn");
    const urlInput = document.getElementById("url-input");
    const status = document.getElementById("status");

    openBtn.addEventListener("click", async () => {
      const url = urlInput.value.trim();
      if (!url) {
        status.textContent = "Please enter a URL.";
        return;
      }

      status.textContent = "Opening...";

      // Open about:blank tab immediately
      const newTab = window.open("about:blank", "_blank");
      if (!newTab) {
        status.textContent = "Popup blocked! Allow popups for this site.";
        return;
      }

      try {
        // Fetch page through proxy
        const res = await fetch(`/proxy?url=${encodeURIComponent(url)}`);
        const html = await res.text();

        // Write into new tab
        newTab.document.open();
        newTab.document.write(html);
        newTab.document.close();
        status.textContent = "Page opened in new tab.";
      } catch (err) {
        console.error(err);
        newTab.document.write("<h1>Failed to load the page.</h1>");
        status.textContent = "Failed to fetch the URL.";
      }
    });
  </script>
</body>
</html>
